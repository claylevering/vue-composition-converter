<!-- eslint-disable vue/no-v-html -->
<template>
  <div class="p-0 mt-4">
    <div class="panel-switch-buttons mt-4">
      <span>
        <v-btn
          data-testid="btn-panel-switch-next"
          block
          class="mb-3 sm:mb-0"
          depressed
          color="primary"
          :disabled="nextBtnDisabled"
          :loading="nextBtnLoading || nextLoading"
          tabindex="1"
          large
          @click="nextClickMethod"
        >
          {{ localNextStepBtnTitle }}
          <v-icon v-if="!hideNextChevron" right>chevron_right</v-icon>
        </v-btn>
      </span>
      <span v-if="showBackButton">
        <v-btn
          depressed
          block
          large
          class="md:mr-4 mt-3"
          color="gray"
          tabindex="2"
          :disabled="nextBtnLoading || nextLoading"
          @click="prevClickMethod"
        >
          <v-icon left>chevron_left</v-icon>
          {{ previousBtnTitle }}
        </v-btn>
      </span>
    </div>

    <v-alert v-if="error" class="my-3" text color="error">
      <span v-html="error" />
    </v-alert>
  </div>
</template>

<script>
import { useGlobalStore, mapState } from '@/stores'

export default {
  name: 'PanelSwitchButtons',

  props: {
    nextBtnText: {
      type: String,
      default: '',
    },
    nextBtnLoading: Boolean,
    nextBtnDisabled: Boolean,
    hidePrev: Boolean,
    hideNextChevron: Boolean,
  },

  data() {
    return {
      nextLoading: false,
      error: null,
    }
  },

  computed: {
    ...mapState(useGlobalStore, [
      'prevPanel',
      'previousBtnTitle',
      'getAppConfig',
      'hidePrevBtn',
      'nextStepBtnTitle',
      'apConfigBtnText',
    ]),
    localNextStepBtnTitle() {
      return this.apConfigBtnText || this.nextBtnText || this.nextStepBtnTitle
    },
    localHidePrevBtn() {
      if (this.hidePrev === true) {
        return true
      } else return this.hidePrevBtn
    },
    showBackButton() {
      return this.prevPanel
      return (
        this.getAppConfig.enable_back_button &&
        !this.localHidePrevBtn &&
        !this.prevPanel?.toLowerCase().startsWith('auth')
      )
    },
  },
  mixins: ["something"],
  methods: {
        ...mapActions(useGlobalStore, [
      'doMoreTHINGS',
    ]),
    async nextClickMethod() {
      this.doMoreTHINGS()
      this.$refs.something.lotsOfThings = true
      this.error = null
      this.nextLoading = true
      this.$emit('next')
    },
    async prevClickMethod() {
      console.log(this.nextBtnText)
      this.error = null
      this.$emit('previous')
    },
  },
}
</script>
